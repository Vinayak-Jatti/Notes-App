<% title = "Dashboard"; /* userName already passed by the route */ %>
<%- include("_header") %>

<!-- ‚îÄ‚îÄ Hero ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="dashboard-hero">
  <h1>My Notes</h1>
  <p class="hero-sub">You have <strong><%= notes.length %></strong> note<%= notes.length !== 1 ? "s" : "" %>.</p>
</div>

<!-- ‚îÄ‚îÄ Validation error (empty title/content on create) ‚îÄ‚îÄ -->
<% if (error) { %>
  <div class="alert alert-error"><%= error %></div>
<% } %>

<!-- ‚îÄ‚îÄ Create Note ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<section class="card create-card">
  <h2 class="card-title">‚úèÔ∏è New Note</h2>
  <form action="/notes/create" method="POST" class="note-form">
    <label for="create-title">Title</label>
    <input type="text" id="create-title" name="title" placeholder="What's on your mind?" required />

    <label for="create-content">Content</label>
    <textarea id="create-content" name="content" placeholder="Write your note here‚Ä¶" rows="4" required></textarea>

    <button type="submit" class="btn btn-primary">Add Note</button>
  </form>
</section>

<!-- ‚îÄ‚îÄ Notes Grid ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<% if (notes.length === 0) { %>
  <div class="empty-state">
    <span class="empty-icon">üìù</span>
    <p>No notes yet ‚Äî create one above!</p>
  </div>
<% } else { %>
  <section class="notes-grid">
    <% notes.forEach((note) => { %>
      <article class="note-card">

        <!-- VIEW mode (shown by default) -->
        <div class="note-view" id="view-<%= note._id %>">
          <h3 class="note-title"><%= note.title %></h3>
          <p  class="note-content"><%= note.content %></p>
          <span class="note-date">
            <%= note.createdAt.toLocaleDateString("en-US", { year:"numeric", month:"short", day:"numeric" }) %>
          </span>
          <div class="note-actions">
            <button type="button" class="btn btn-outline btn-sm"
                    onclick="toggleEdit('<%= note._id %>')">Edit</button>
            <form action="/notes/delete/<%= note._id %>" method="POST" class="inline-form">
              <button type="submit" class="btn btn-danger btn-sm"
                      onclick="return confirm('Delete this note?')">Delete</button>
            </form>
          </div>
        </div>

        <!-- EDIT mode (hidden by default) -->
        <div class="note-edit" id="edit-<%= note._id %>" style="display:none;">
          <form action="/notes/update/<%= note._id %>" method="POST" class="note-form">
            <label>Title</label>
            <input type="text" name="title" value="<%= note.title %>" required />

            <label>Content</label>
            <textarea name="content" rows="4" required><%= note.content %></textarea>

            <div class="edit-actions">
              <button type="submit" class="btn btn-primary btn-sm">Save</button>
              <button type="button"  class="btn btn-outline btn-sm"
                      onclick="toggleEdit('<%= note._id %>')">Cancel</button>
            </div>
          </form>
        </div>

      </article>
    <% }); %>
  </section>
<% } %>

<!-- ‚îÄ‚îÄ Tiny toggle helper ‚Äî no libraries ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<script>
  function toggleEdit(id) {
    const view = document.getElementById("view-" + id);
    const edit = document.getElementById("edit-" + id);
    const editing = edit.style.display === "block";
    view.style.display = editing ? "block" : "none";
    edit.style.display = editing ? "none"  : "block";
  }
</script>

<%- include("_footer") %>
